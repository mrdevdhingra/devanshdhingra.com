<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devansh's Shenanigans</title>
</head>
<body>
    <h1>Welcome to Devansh's Shenanigans!</h1>
    
    <p><a href="https://ai.devanshdhingra.com" target="_blank">Detechly's AI Image Generation</a></p>
    <p><a href="https://cvcreatorai.devanshdhingra.com" target="_blank">Detechly's AI CV Creator</a></p>
    <p><a href="https://sizechart.devanshdhingra.com" target="_blank">Shopify Size utility</a></p>

    <hr>

    <h2>Report a Bug</h2>
    
    <div id="message"></div>
    
    <form id="bugForm">
        <label for="bugDescription">Bug Description:</label><br>
        <textarea id="bugDescription" name="bugDescription" required rows="4" cols="50"></textarea><br>
        <button type="submit" id="submitBtn">Submit Bug Report</button>
    </form>

    <hr>

    <h3>All Bug Reports</h3>
    <div id="bugsList">
        <p>Loading bugs...</p>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxOsbiqcPWIPmWdW7qqORNyKCCdEkLDcehnCRN4Wbri0WbnmsMrYemCcW27AHs4b8VRzw/exec';

        // Load bugs when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadBugs();
        });

        // Handle form submission
        document.getElementById('bugForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const bugDescription = document.getElementById('bugDescription').value.trim();
            const submitBtn = document.getElementById('submitBtn');
            const messageDiv = document.getElementById('message');
            
            if (!bugDescription) {
                messageDiv.innerHTML = '<p>Please enter a bug description</p>';
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addBug',
                        bug: bugDescription
                    })
                });

                messageDiv.innerHTML = '<p><b>Bug report submitted successfully!</b></p>';
                document.getElementById('bugForm').reset();
                
                setTimeout(() => {
                    messageDiv.innerHTML = '';
                    loadBugs();
                }, 1000);

            } catch (error) {
                console.error('Error submitting bug:', error);
                messageDiv.innerHTML = '<p><b>Error submitting bug report. Please try again.</b></p>';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Bug Report';
            }
        });

        // Load all bugs from Google Sheets
        async function loadBugs() {
            const bugsList = document.getElementById('bugsList');
            bugsList.innerHTML = '<p>Loading bugs...</p>';

            try {
                const response = await fetch(`${SCRIPT_URL}?action=getBugs`);
                const data = await response.json();

                if (data.bugs && data.bugs.length > 0) {
                    let html = '<ul>';
                    data.bugs.forEach(bug => {
                        html += `<li><b>[${bug.status}]</b> ${escapeHtml(bug.bug)} <i>(${bug.date})</i></li>`;
                    });
                    html += '</ul>';
                    bugsList.innerHTML = html;
                } else {
                    bugsList.innerHTML = '<p>No bugs reported yet.</p>';
                }
            } catch (error) {
                console.error('Error loading bugs:', error);
                bugsList.innerHTML = '<p>Error loading bugs. Please make sure your Google Apps Script is deployed correctly.</p>';
            }
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
